---
title: "Authenticate a User with Email"
sidebar_position: 4
description: Authenticate a User with a Email
slug: /embedded-wallets/code-examples/authenticate-user-email
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";
import CodeBlock from "@theme/CodeBlock";
import Parameter from "@site/src/components/parameter";

This flow can both be used to login a user with only an email address, or to recover the account of a user that has lost their passkey credential with their email address. The end result is a valid `TurnkeyClient` which can also be used to add another authenbticator if needed.

#### 1. Initialize Turnkey

<CodeBlock language="typescript">
  {`import { Turnkey, TurnkeySDKBrowserConfig } from "@turnkey/sdk-browser";`}
  {`\nimport turnkeyConfig from "./turnkey.json"`}
  {`\n\nconst turnkey = new Turnkey(turnkeyConfig);`}
</CodeBlock>

#### 2. Initialize the Iframe Client

Note that the iframe client must be initialized with the dom element where the iframe will be injected. If you are using the [react-sdk](/sdks/react) you can import the `authIframeClient` from the `useTurnkey()` hook without this step and the iframe dom element will be managed for you. Note that the `iframeClient` must be initialized before calling `emailAuth` because you need the `iframePublicKey` as a parameter to the `emailAuth` call.

<CodeBlock language="typescript">
  {`import { Turnkey, TurnkeySDKBrowserConfig } from "@turnkey/sdk-browser";`}
  {`\n\nconst turnkeyConfig: TurnkeySDKBrowserConfig = {...};`}
  {`\nconst turnkey = new Turnkey(turnkeyConfig);`}
  {`\n\nconst iframeContainerId = "turnkey-auth-iframe-container-id";`}
  {`\n\n// ensure the HTML element exists somewhere in the rendered DOM`}
  {`\n<div id={iframeContainerId} />`}
  {`\n\nconst authIframeClient = await turnkey.iframeClient(document.getElementById(iframeContainerId))`}
</CodeBlock>

#### 3. Call `emailAuth` from your backend

<CodeBlock language="typescript">
  {`await turnkey.serverSign(
  "emailAuth",
  [{
    email: <userEmail>,
    targetPublicKey: authIframeClient.iframePublicKey,
    organizationId: <userSubOrganizationId>
  }]
)`}
</CodeBlock>

If you need to lookup the user `subOrganizationId` by email, you can call the `getSubOrgIds` method with the `filterType` parameter set to `"EMAIL"`

<CodeBlock language="typescript">
  {`const subOrgIds = await turnkey.serverSign(
  "getSubOrgIds",
  [{
    filterType: "EMAIL",
    filterValue: <userEmail>
  }]
)`}
  {`\n\nconst userSubOrganizationId = subOrgIds.organizationIds[0];`}
</CodeBlock>

#### 4. Inject the emailed `credentialBundle` into the iframe to authenticate the user

<CodeBlock language="typescript">
  {`const authenticationResponse = await authIframeClient.injectCredentialBundle(credentialBundle);
if (authenticationResponse) {
  // user is authenticated and can perform actions from the \`iframeClient\`
  await authIframeClient.login();
  navigate("/authenticated-route");
} else {
  // credential bundle does not match emailed credential
  navigate("/not-authenticated-route");
}
`}
</CodeBlock>

#### 5. Make read requests on behalf of the authenticated user from the `currentUserSession`

<CodeBlock language="typescript">
  {`const currentUserSession = await turnkey.currentUserSession();`}
  {`\nconst walletsResponse = await currentUserSession.getWallets()`}
  {`\nconst walletName = walletsResponse.wallets[0].walletName`}
</CodeBlock>

#### 6. Call the `iframeClient` directly for write requests

<CodeBlock language="typescript">
  {`import { DEFAULT_ETHEREUM_ACCOUNTS } from "@turnkey/sdk-browser";`}
  {`\nconst newWalletResponse = await authIframeClient.createWallet({
  walletName: "New Wallet for User",
  accounts: DEFAULT_ETHEREUM_ACCOUNTS
})`}
</CodeBlock>
